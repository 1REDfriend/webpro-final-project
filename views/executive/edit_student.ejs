<%- include('../layouts/header') %>

    <style>
        .pic-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent);
            margin-bottom: .75rem;
        }

        .section-header {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-main);
            border-bottom: 2px solid var(--accent);
            padding-bottom: .4rem;
            margin: 1.5rem 0 1rem;
        }

        .tag-pill {
            background: rgba(99, 102, 241, 0.12);
            color: var(--accent);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: .82em;
            font-weight: 600;
        }
    </style>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
        <h2 style="margin:0;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
        <div style="display:flex;gap:.5rem;">
            <a href="/executive/students/<%= student.student_id %>/manage" class="btn btn-secondary">‚öô ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</a>
            <a href="/executive/students" class="btn btn-secondary">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
        </div>
    </div>

    <% if (error) { %>
        <div style="background:#f8d7da;color:#721c24;padding:10px;border-radius:8px;margin-bottom:1rem;">
            <%= error %>
        </div>
        <% } %>
            <% if (success) { %>
                <div style="background:#d4edda;color:#155724;padding:10px;border-radius:8px;margin-bottom:1rem;">
                    <%= success %>
                </div>
                <% } %>

                    <div class="grid-2" style="align-items:start; gap:1.5rem;">
                        <!-- Main Edit Form -->
                        <div class="card">
                            <form action="/executive/students/<%= student.student_id %>/edit" method="POST"
                                enctype="multipart/form-data">
                                <input type="hidden" name="existing_pic"
                                    value="<%= student.profile_pic || 'default-profile-men.png' %>">

                                <!-- Profile Picture -->
                                <div class="section-header">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
                                <div style="display:flex; gap:1.5rem; align-items:center; margin-bottom:1rem;">
                                    <div style="text-align:center;">
                                        <% let picSrc='/image/default-profile-men.png' ; if (student.profile_pic &&
                                            student.profile_pic !=='default.png' ) {
                                            picSrc=student.profile_pic.startsWith('http') ||
                                            student.profile_pic.startsWith('/') ? student.profile_pic : '/image/' +
                                            student.profile_pic; } %>
                                            <img src="<%= picSrc %>" alt="Profile" class="pic-preview" id="picPreview">
                                    </div>
                                    <div>
                                        <label style="font-size:.88em;color:var(--text-muted);">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</label>
                                        <input type="file" name="profile_pic_file" accept="image/*" class="form-control"
                                            style="margin-bottom:.5rem;"
                                            onchange="document.getElementById('picPreview').src=URL.createObjectURL(this.files[0])">
                                        <label
                                            style="font-size:.82em;color:var(--text-muted);display:flex;align-items:center;gap:.4rem;">
                                            <input type="checkbox" name="clear_pic" value="1">
                                            ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
                                        </label>
                                    </div>
                                </div>

                                <!-- Basic Info -->
                                <div class="section-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                                <div class="form-group mb-3">
                                    <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" name="full_name" class="form-control"
                                        value="<%= student.full_name %>" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <small class="text-muted">(‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Username
                                            ‡∏î‡πâ‡∏ß‡∏¢)</small></label>
                                    <input type="text" name="student_code" class="form-control"
                                        value="<%= student.student_code %>" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label>‡πÄ‡∏û‡∏®</label>
                                    <select name="gender" class="form-control">
                                        <option value="male" <%=student.gender==='male' ?'selected':''%>>‡∏ä‡∏≤‡∏¢</option>
                                        <option value="female" <%=student.gender==='female' ?'selected':''%>>‡∏´‡∏ç‡∏¥‡∏á
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group mb-3">
                                    <label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <select name="classroom_id" class="form-control" required>
                                        <% classrooms.forEach(c=> { %>
                                            <option value="<%= c.id %>" <%=student.classroom_id===c.id?'selected':''%>>
                                                <%= c.name %>
                                            </option>
                                            <% }) %>
                                    </select>
                                </div>
                                <div class="form-group mb-4">
                                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà <small
                                            class="text-muted">(‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</small></label>
                                    <input type="password" name="password" class="form-control"
                                        placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                                </div>

                                <button type="submit" class="btn btn-primary" style="width:100%;">üíæ
                                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                            </form>
                        </div>

                        <!-- Enrolled Subjects Panel -->
                        <div class="card">
                            <div class="section-header" style="margin-top:0;">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (<%=
                                    enrolledSubjects.length %> ‡∏ß‡∏¥‡∏ä‡∏≤)</div>
                            <% if (enrolledSubjects.length> 0) { %>
                                <table style="width:100%;border-collapse:collapse;font-size:.9em;">
                                    <thead>
                                        <tr>
                                            <th
                                                style="text-align:left;padding:.4rem .5rem;border-bottom:1px solid var(--border);">
                                                ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</th>
                                            <th
                                                style="text-align:left;padding:.4rem .5rem;border-bottom:1px solid var(--border);">
                                                ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</th>
                                            <th
                                                style="text-align:center;padding:.4rem .5rem;border-bottom:1px solid var(--border);">
                                                ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% enrolledSubjects.forEach(s=> { %>
                                            <tr>
                                                <td style="padding:.4rem .5rem;"><span class="tag-pill">
                                                        <%= s.code %>
                                                    </span></td>
                                                <td style="padding:.4rem .5rem;">
                                                    <%= s.name %>
                                                </td>
                                                <td style="padding:.4rem .5rem;text-align:center;">
                                                    <%= s.credit %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                </table>
                                <p style="margin-top:.75rem;font-size:.8em;color:var(--text-muted);">
                                    ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° <strong>‚öô ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                                <% } else { %>
                                    <p class="text-muted" style="margin:0;font-size:.88em;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏î</p>
                                    <% } %>
                        </div>
                    </div>

                    <%- include('../layouts/footer') %>