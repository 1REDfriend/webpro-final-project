<%- include('../layouts/header') %>

    <h2 class="mb-4">จัดการบุคลากรครู</h2>



    <div class="grid-2">
        <!-- Add Teacher Form -->
        <div class="card">
            <h3>เพิ่มบุคลากรครูใหม่</h3>
            <form action="/executive/teachers" method="POST" style="margin-top: 1rem;">
                <div class="form-group mb-3">
                    <label>ชื่อ-นามสกุล</label>
                    <input type="text" name="full_name" class="form-control" required placeholder="นายสมชาย ใจดี">
                </div>
                <div class="form-group mb-3">
                    <label>ชื่อผู้ใช้งาน (Username สำหรับเข้าสู่ระบบ)</label>
                    <input type="text" name="username" class="form-control" required placeholder="t_somchai">
                </div>
                <div class="form-group mb-3">
                    <label>รหัสผ่าน</label>
                    <input type="text" name="password" class="form-control" required
                        placeholder="กำหนดรหัสผ่านเบื้องต้น">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">เพิ่มบุคลากรครู</button>
            </form>
        </div>

        <!-- Teacher List -->
        <div class="card">
            <h3>รายชื่อครูทั้งหมด</h3>
            <% if (teachers && teachers.length> 0) { %>
                <!-- Search -->
                <div
                    style="display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,0.05);border:1px solid var(--border);border-radius:8px;padding:.4rem .75rem;margin:.75rem 0;">
                    <i data-lucide="search" style="width:16px;height:16px;color:var(--text-muted);flex-shrink:0;"></i>
                    <input id="teacherSearch" type="text" placeholder="ค้นหาชื่อครู, ชื่อผู้ใช้..."
                        style="border:none;background:transparent;outline:none;font-size:0.9rem;color:var(--text-main);width:100%;"
                        oninput="filterTeacherRows()">
                </div>
                <div style="overflow-x: auto; margin-top: 1rem;">
                    <table>
                        <thead>
                            <tr>
                                <th>รูปภาพ</th>
                                <th>ชื่อ-นามสกุล</th>
                                <th>ชื่อผู้ใช้</th>
                                <th>จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="teacherTbody">
                            <% teachers.forEach(t=> { %>
                                <tr>
                                    <td>
                                        <img src="/image/<%= t.profile_pic === 'default.png' ? 'default-profile.png' : t.profile_pic %>"
                                            alt="<%= t.full_name %>"
                                            style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                    </td>
                                    <td>
                                        <%= t.full_name %>
                                    </td>
                                    <td>
                                        <%= t.username %>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                                            <a href="/executive/teachers/<%= t.id %>/edit" title="แก้ไข"
                                                style="color: #f39c12; transition: transform 0.2s;">
                                                <i data-lucide="pencil" style="width: 20px; height: 20px;"></i>
                                            </a>
                                            <form action="/executive/teachers/delete" method="POST"
                                                onsubmit="confirmAction(event, 'ยืนยันการลบครูท่านนี้? หากลบแล้วจะทำให้รายวิชาที่ครูท่านนี้รับผิดชอบอยู่ไม่มีผู้สอน');"
                                                style="margin: 0; padding: 0;">
                                                <input type="hidden" name="teacher_id" value="<%= t.id %>">
                                                <button type="submit" title="ลบ"
                                                    style="background: none; border: none; padding: 0; color: #e74c3c; cursor: pointer; transition: transform 0.2s;">
                                                    <i data-lucide="trash-2" style="width: 20px; height: 20px;"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                <% }); %>
                        </tbody>
                    </table>
                </div>
                <% } else { %>
                    <p class="text-muted mt-4">ยังไม่มีบุคลากรครูในระบบ</p>
                    <% } %>
        </div>
    </div>

    <script>
        function filterTeacherRows() {
            const q = document.getElementById('teacherSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#teacherTbody tr');
            rows.forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
            });
        }
    </script>

    <%- include('../layouts/footer') %>