<%- include('../layouts/header') %>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">แผงควบคุมผู้บริหาร</h2>
        <div style="display: flex; gap: 1rem; align-items: center;">
            <% let profileImg='/image/default-profile.png' ; if (user && user.profile_pic && user.profile_pic
                !=='default.png' ) { profileImg=user.profile_pic.startsWith('http') || user.profile_pic.startsWith('/')
                ? user.profile_pic : '/image/' + user.profile_pic; } %>
                <div style="text-align: right;">
                    <p style="margin: 0; font-weight: bold;">
                        <%= user ? user.full_name : 'ผู้บริหาร' %>
                    </p>
                    <small class="text-muted">ผู้อำนวยการ / ผู้บริหาร</small>
                </div>
                <img src="<%= profileImg %>" alt="Profile"
                    style="border-radius: 50%; width: 50px; height: 50px; object-fit: cover; border: 2px solid var(--primary);">
        </div>
    </div>

    <div class="grid-4 mb-4">
        <div class="card" style="text-align: center; border-top: 4px solid var(--primary);">
            <h4 class="text-muted">จำนวนนักเรียน</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">
                <%= stats.studentCount %>
            </div>
            <p class="text-muted">คน ทั้งหมด</p>
        </div>

        <div class="card" style="text-align: center; border-top: 4px solid var(--accent);">
            <h4 class="text-muted">จำนวนครู</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent);">
                <%= stats.teacherCount %>
            </div>
            <p class="text-muted">คน ทั้งหมด</p>
        </div>

        <div class="card" style="text-align: center; border-top: 4px solid #6c5ce7;">
            <h4 class="text-muted">พนักงาน/ฝ่ายธุรการ</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: #6c5ce7;">
                <%= stats.staffCount %>
            </div>
            <p class="text-muted">คน ทั้งหมด</p>
        </div>

        <div class="card" style="text-align: center; border-top: 4px solid #00b894;">
            <h4 class="text-muted">เกรดเฉลี่ยรวม (โรงเรียน)</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: #00b894;">
                <%= stats.avgGpa %>
            </div>
            <p class="text-muted">GPA</p>
        </div>
    </div>

    <div class="grid-2">
        <div class="card">
            <h3>สถิติคำร้อง</h3>
            <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
                <div
                    style="display: flex; justify-content: space-between; padding: 1rem; background: #ffc400; border-radius: 8px;">
                    <span style="font-weight: bold; color: #ffffff;">รอดำเนินการ</span>
                    <span style="font-weight: bold; font-size: 1.2rem;">
                        <%= stats.requestPendingCount %>
                    </span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; padding: 1rem; background: #0bad31; border-radius: 8px;">
                    <span style="font-weight: bold; color: #ffffff;">อนุมัติแล้ว</span>
                    <span style="font-weight: bold; font-size: 1.2rem;">
                        <%= stats.requestApprovedCount %>
                    </span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; padding: 1rem; background: #dd2333; border-radius: 8px;">
                    <span style="font-weight: bold; color: #ffffff;">ปฏิเสธ</span>
                    <span style="font-weight: bold; font-size: 1.2rem;">
                        <%= stats.requestRejectedCount %>
                    </span>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>เกรดเฉลี่ยแยกตามห้องเรียน</h3>
            <% if (stats.gpaByClassroom && stats.gpaByClassroom.length> 0) { %>
                <table style="margin-top: 1rem;">
                    <thead>
                        <tr>
                            <th>ห้องเรียน</th>
                            <th>เกรดเฉลี่ย</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% stats.gpaByClassroom.forEach(item=> { %>
                            <tr>
                                <td>
                                    <%= item.classroom %>
                                </td>
                                <td
                                    style="font-weight: bold; color: <%= item.gpa >= 3.0 ? '#00b894' : (item.gpa >= 2.0 ? '#e1b12c' : '#ff6b6b') %>;">
                                    <%= item.gpa %>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
                <% } else { %>
                    <p class="text-muted mt-4">ยังไม่มีข้อมูลผลการเรียนที่ถูกประมวลผลสำหรับรายห้อง</p>
                    <% } %>
        </div>
    </div>

    <%- include('../layouts/footer') %>