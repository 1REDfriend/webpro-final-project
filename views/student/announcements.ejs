<%- include('../layouts/header') %>

    <style>
        .announce-grid-all {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.25rem;
            margin-top: 1rem;
        }

        .announce-hcard {
            position: relative;
            border-radius: 14px;
            overflow: hidden;
            background: var(--bg-card);
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
            aspect-ratio: 4 / 3;
        }

        .announce-hcard:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 28px rgba(0, 0, 0, 0.3);
        }

        .announce-hcard.has-image .announce-hcard-img-wrap {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .announce-hcard.has-image .announce-hcard-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .announce-hcard.has-image .announce-hcard-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent 0%, rgba(0, 0, 0, 0.72) 50%, rgba(0, 0, 0, 0.92) 100%);
            padding: 1.5rem 1rem 0.9rem;
            color: #fff;
        }

        .announce-hcard.has-image .announce-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
            color: #fff;
        }

        .announce-hcard.has-image .announce-desc {
            font-size: 0.82rem;
            color: rgba(255, 255, 255, .82);
            margin: 0 0 0.3rem;
        }

        .announce-hcard.has-image .announce-date {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, .6);
        }

        .announce-hcard.no-image {
            padding: 1.25rem;
            border-left: 4px solid var(--primary);
        }

        .announce-hcard.no-image .announce-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: var(--text-main);
        }

        .announce-hcard.no-image .announce-desc {
            font-size: 0.88rem;
            color: var(--text-muted);
            margin: 0 0 0.5rem;
            flex: 1;
        }

        .announce-hcard.no-image .announce-date {
            font-size: 0.78rem;
            color: var(--text-muted);
        }
    </style>

    <div
        style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:.75rem;">
        <div style="display:flex;align-items:center;gap:1rem;">
            <a href="/student/dashboard" class="btn btn-secondary"
                style="display:inline-flex;align-items:center;gap:.4rem;">
                <i data-lucide="arrow-left" style="width:16px;height:16px;"></i> กลับ
            </a>
            <h2 style="margin:0;">ประกาศจากโรงเรียนทั้งหมด</h2>
        </div>
        <div style="position:relative;">
            <i data-lucide="search"
                style="position:absolute;left:.65rem;top:50%;transform:translateY(-50%);width:15px;height:15px;color:var(--text-muted);pointer-events:none;"></i>
            <input type="text" id="searchAll" placeholder="ค้นหาประกาศ..." oninput="filterAll(this.value)"
                style="padding:.45rem .85rem .45rem 2.1rem;border-radius:10px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-main);font-size:.9rem;width:220px;">
        </div>
    </div>

    <% if (announcements && announcements.length> 0) { %>
        <div class="announce-grid-all" id="allGrid">
            <% announcements.forEach(a=> { %>
                <a href="/student/announcements/<%= a.id %>"
                    class="announce-hcard <%= a.image_url ? 'has-image' : 'no-image' %>"
                    data-title="<%= (a.title || '').toLowerCase() %>"
                    data-desc="<%= (a.description || '').toLowerCase() %>">
                    <% if (a.image_url) { %>
                        <div class="announce-hcard-img-wrap">
                            <img src="<%= a.image_url %>" alt="<%= a.title %>" class="announce-hcard-img">
                            <div class="announce-hcard-overlay">
                                <div class="announce-title">
                                    <%= a.title %>
                                </div>
                                <p class="announce-desc">
                                    <%= a.description ? a.description.substring(0, 80) : '' %>
                                        <%= a.description && a.description.length> 80 ? '...' : '' %>
                                </p>
                                <div class="announce-date">
                                    <%= new Date(a.created_at).toLocaleDateString('th-TH', { year: 'numeric' ,
                                        month: 'long' , day: 'numeric' }) %>
                                </div>
                            </div>
                        </div>
                        <% } else { %>
                            <div class="announce-title">
                                <%= a.title %>
                            </div>
                            <p class="announce-desc">
                                <%= a.description ? a.description.substring(0, 100) : '' %>
                                    <%= a.description && a.description.length> 100 ? '...' : '' %>
                            </p>
                            <div class="announce-date">
                                <%= new Date(a.created_at).toLocaleDateString('th-TH', { year: 'numeric' , month: 'long'
                                    , day: 'numeric' }) %>
                            </div>
                            <% } %>
                </a>
                <% }); %>
        </div>
        <p id="noResult" style="display:none;color:var(--text-muted);text-align:center;padding:2rem 0;">
            ไม่พบประกาศที่ค้นหา</p>
        <% } else { %>
            <div class="card" style="text-align:center;padding:3rem;">
                <i data-lucide="megaphone"
                    style="width:48px;height:48px;color:var(--text-muted);margin-bottom:1rem;"></i>
                <p class="text-muted">ยังไม่มีประกาศในระบบ</p>
            </div>
            <% } %>

                <script>
                    function filterAll(q) {
                        q = q.toLowerCase().trim();
                        const cards = document.querySelectorAll('#allGrid .announce-hcard');
                        let visible = 0;
                        cards.forEach(c => {
                            const match = !q || c.dataset.title.includes(q) || c.dataset.desc.includes(q);
                            c.style.display = match ? '' : 'none';
                            if (match) visible++;
                        });
                        document.getElementById('noResult').style.display = visible === 0 && q ? '' : 'none';
                    }
                </script>

                <%- include('../layouts/footer') %>