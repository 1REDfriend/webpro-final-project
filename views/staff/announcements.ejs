<%- include('../layouts/header') %>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">จัดการประกาศโรงเรียน</h2>
        <a href="/staff/dashboard" class="btn btn-secondary">← กลับ</a>
    </div>

    <div class="grid-2 mb-4" style="gap: 2rem;">
        <!-- Add Announcement Form -->
        <div class="card">
            <h3>สร้างประกาศใหม่</h3>
            <form action="/staff/announcements" method="POST" style="margin-top: 1rem;">
                <div class="form-group">
                    <label>หัวข้อประกาศ</label>
                    <input type="text" name="title" class="form-control" required placeholder="ชื่อประกาศ">
                </div>
                <div class="form-group">
                    <label>รายละเอียด (สนับสนุน Markdown)</label>
                    <textarea name="description" class="form-control" rows="6" required
                        placeholder="# หัวข้อ&#10;รายละเอียดประกาศ...&#10;&#10;**ตัวหนา** หรือ *ตัวเอียง*"></textarea>
                </div>
                <div class="form-group">
                    <label>URL รูปภาพ (ถ้ามี)</label>
                    <input type="url" name="image_url" class="form-control" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>กลุ่มเป้าหมาย</label>
                    <select name="target_audience" class="form-control" required>
                        <option value="both">ทุกคน (ทั้งนักเรียนและครู)</option>
                        <option value="student">นักเรียนเท่านั้น</option>
                        <option value="teacher">ครูเท่านั้น</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">เผยแพร่ประกาศ</button>
            </form>
        </div>

        <!-- Announcements List -->
        <div class="card">
            <h3>ประกาศที่มีอยู่</h3>
            <% if (announcements && announcements.length> 0) { %>
                <div
                    style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; max-height: 600px; overflow-y: auto;">
                    <% announcements.forEach(a=> { %>
                        <div
                            style="border: 1px solid #e2e8f0; border-radius: 10px; padding: 1rem; background: #f8fafc;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div style="flex: 1;">
                                    <strong>
                                        <%= a.title %>
                                    </strong>
                                    <div style="margin-top: 0.25rem;">
                                        <% let badgeBg='#f3e8ff' ; let badgeColor='#7e22ce' ; if
                                            (a.target_audience==='student' ) { badgeBg='#dbeafe' ; badgeColor='#1d4ed8'
                                            ; } else if (a.target_audience==='teacher' ) { badgeBg='#dcfce7' ;
                                            badgeColor='#15803d' ; } %>
                                            <span
                                                style="font-size: 0.8em; padding: 2px 8px; border-radius: 20px; background: <%= badgeBg %>; color: <%= badgeColor %>;">
                                                <%= a.target_audience==='both' ? 'ทุกคน' : a.target_audience==='student'
                                                    ? 'นักเรียน' : 'ครู' %>
                                            </span>
                                    </div>
                                    <small class="text-muted" style="display: block; margin-top: 0.5rem;">
                                        <%= new Date(a.created_at).toLocaleDateString('th-TH', { year: 'numeric' ,
                                            month: 'long' , day: 'numeric' }) %>
                                    </small>
                                </div>
                                <form action="/staff/announcements/delete" method="POST" style="margin: 0;">
                                    <input type="hidden" name="id" value="<%= a.id %>">
                                    <button type="submit" title="ลบประกาศ" onclick="return confirm('ยืนยันลบประกาศ?')"
                                        style="background: none; border: none; color: #e74c3c; cursor: pointer; padding: 4px;">
                                        <i data-lucide="trash-2" style="width:18px; height:18px;"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                        <% }); %>
                </div>
                <% } else { %>
                    <p class="text-muted mt-4">ยังไม่มีประกาศในระบบ</p>
                    <% } %>
        </div>
    </div>

    <%- include('../layouts/footer') %>