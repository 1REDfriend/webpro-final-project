<%- include('../layouts/header') %>

    <h2 class="mb-4">จัดการห้องเรียนและคะแนน</h2>

    <div class="card mb-4">
        <h3>รายชื่อนักเรียน</h3>
        <form action="/teacher/classes" method="GET" class="mb-4"
            style="display: flex; gap: 1rem; align-items: flex-end;">
            <div class="form-group" style="margin: 0;">
                <label>เปลี่ยนห้องเรียน</label>
                <select name="classroom_id" class="form-control">
                    <option value="">-- ทุกห้อง --</option>
                    <% classrooms.forEach(c=> { %>
                        <option value="<%= c.id %>" <%=filters.classroom_id==c.id ? 'selected' : '' %>><%= c.name %>
                        </option>
                        <% }); %>
                </select>
            </div>
            <div class="form-group" style="margin: 0;">
                <label>เลือกวิชาที่สอน (เพื่อดูนักเรียนที่ลงทะเบียน)</label>
                <select name="subject_id" class="form-control">
                    <option value="">-- ทุกวิชา --</option>
                    <% subjects.forEach(sub=> { %>
                        <option value="<%= sub.id %>" <%=filters.subject_id==sub.id ? 'selected' : '' %>><%= sub.code %>
                                - <%= sub.name %>
                        </option>
                        <% }); %>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="padding: 0.5rem 1.2rem;">กรองข้อมูล</button>
            <a href="/teacher/classes" class="btn btn-secondary" style="padding: 0.5rem 1.2rem;">ล้างตัวกรอง</a>
        </form>

        <table>
            <thead>
                <tr>
                    <th>ห้อง</th>
                    <th>รหัส</th>
                    <th>ชื่อ-นามสกุล</th>
                    <th>คะแนนพฤติกรรม</th>
                    <th>ผลการเรียน</th>
                    <th>ปรับคะแนน</th>
                </tr>
            </thead>
            <tbody>
                <% students.forEach(s=> { %>
                    <tr>
                        <td>
                            <%= s.classroom_name %>
                        </td>
                        <td>
                            <%= s.student_code %>
                        </td>
                        <td>
                            <%= s.name %>
                        </td>
                        <td style="font-weight: bold; color: <%= s.behavior_score < 50 ? '#ff6b6b' : '#00b894' %>">
                            <%= s.behavior_score %>
                        </td>
                        <td>
                            <a href="/teacher/student/<%= s.id %>/grades" class="btn btn-primary"
                                style="padding: 0.3rem 0.8rem; font-size: 0.9em;">ดูเกรด</a>
                        </td>
                        <td>
                            <form action="/teacher/behavior" method="POST"
                                style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="hidden" name="student_id" value="<%= s.id %>">
                                <input type="number" name="score_change" placeholder="+/-" style="width: 70px;"
                                    required>
                                <button type="submit" class="btn btn-secondary"
                                    style="padding: 0.3rem 0.8rem;">บันทึก</button>
                            </form>
                        </td>
                    </tr>
                    <% }); %>
            </tbody>
        </table>
    </div>

    <div class="card">
        <h3>ลงคะแนนสอบ</h3>
        <p class="text-muted mb-4">เลือกวิชาและนักเรียนเพื่อบันทึกคะแนน (Demo: กรอก Student ID และ Subject ID)</p>
        <form action="/teacher/grade" method="POST" class="grid-4" style="align-items: end;">
            <div class="form-group" style="margin: 0;">
                <label>รหัสนักเรียน</label>
                <input type="number" name="student_id" class="form-control" placeholder="ID" required>
            </div>
            <div class="form-group" style="margin: 0;">
                <label>รหัสวิชา</label>
                <input type="number" name="subject_id" class="form-control" placeholder="ID" required>
            </div>
            <div class="form-group" style="margin: 0;">
                <label>Midterm (50)</label>
                <input type="number" name="grade_midterm" class="form-control" max="50" required>
            </div>
            <div class="form-group" style="margin: 0;">
                <label>Final (50)</label>
                <input type="number" name="grade_final" class="form-control" max="50" required>
            </div>
            <button type="submit" class="btn btn-primary"
                style="grid-column: span 4; margin-top: 1rem;">บันทึกคะแนน</button>
        </form>

        <div class="mt-4">
            <h4>รหัสวิชาของท่าน:</h4>
            <ul>
                <% subjects.forEach(sub=> { %>
                    <li>ID: <strong>
                            <%= sub.id %>
                        </strong> | <%= sub.code %> - <%= sub.name %>
                    </li>
                    <% }) %>
            </ul>
        </div>
    </div>

    <%- include('../layouts/footer') %>